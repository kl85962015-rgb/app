<!--pages/regulation-select/regulation-select.wxml-->
<view class="page-container">
  
  <!-- é¡¶éƒ¨ Tab æ  -->
  <view class="top-tabs">
    <scroll-view class="tabs-scroll" scroll-x enable-flex>
      <view class="tab-item {{activeTab === 'professional' ? 'active' : ''}}" bindtap="switchTab" data-tab="professional">ä¸“ä¸šä¾æ®</view>
      <view class="tab-item {{activeTab === 'common' ? 'active' : ''}}" bindtap="switchTab" data-tab="common">å¸¸ç”¨ä¾æ®</view>
      <view class="tab-item {{activeTab === 'favorite' ? 'active' : ''}}" bindtap="switchTab" data-tab="favorite">æˆ‘çš„æ”¶è—</view>
      <view class="tab-item {{activeTab === 'history' ? 'active' : ''}}" bindtap="switchTab" data-tab="history">å†å²ä¾æ®</view>
      <view class="tab-item {{activeTab === 'manual' ? 'active' : ''}}" bindtap="switchTab" data-tab="manual">æ‰‹åŠ¨ä¾æ®</view>
    </scroll-view>
  </view>

  <!-- ä¸“ä¸šä¾æ®æ¨¡å¼ï¼šå·¦å³å¸ƒå±€ -->
  <view class="professional-layout" wx:if="{{activeTab === 'professional'}}">
    
    <!-- å·¦ä¾§åˆ†ç±»åˆ—è¡¨ -->
    <scroll-view class="category-sidebar" scroll-y>
      <view class="cat-item {{currentCategory === item.id ? 'active' : ''}}" 
            wx:for="{{categories}}" wx:key="id"
            bindtap="selectCategory" data-id="{{item.id}}">
        {{item.name}}
      </view>
    </scroll-view>
    
    <!-- å³ä¾§ä¾æ®ç½‘æ ¼ -->
    <scroll-view class="regulation-grid-area" scroll-y>
      <view class="grid-container">
        <view class="grid-item" wx:for="{{categoryItems}}" wx:key="id" bindtap="selectRegulationItem" data-item="{{item}}">
          <view class="grid-icon" style="background: {{item.iconBg || '#EFF6FF'}}">
            <text class="icon-emoji">{{item.icon || 'ğŸ“‹'}}</text>
          </view>
          <text class="grid-label">{{item.name}}</text>
        </view>
      </view>
    </scroll-view>
    
  </view>

  <!-- åˆ—è¡¨æ¨¡å¼ï¼ˆå¸¸ç”¨/æ”¶è—/å†å²ï¼‰ -->
  <view class="list-layout" wx:if="{{activeTab !== 'professional' && activeTab !== 'manual'}}">
    
    <!-- æœç´¢æ¡† -->
    <view class="search-bar">
      <text class="search-icon">ğŸ”</text>
      <input class="search-input" placeholder="æœç´¢" bindinput="onSearchInput" value="{{searchKeyword}}" />
    </view>
    
    <!-- ç­›é€‰æ ‡ç­¾ -->
    <view class="filter-tag-bar">
      <view class="filter-tag active">å…¨éƒ¨</view>
    </view>
    
    <!-- æ³•è§„å¡ç‰‡åˆ—è¡¨ -->
    <scroll-view class="regulation-card-list" scroll-y>
      <view class="reg-card" wx:for="{{regulationList}}" wx:key="id">
        <view class="card-header">
          <text class="keyword-label">ã€å…³é”®è¯ã€‘</text>
          <text class="keyword-text">{{item.keywords}}</text>
        </view>
        
        <view class="card-row">
          <text class="row-label">ã€éšæ‚£æè¿°ã€‘</text>
          <text class="row-content">{{item.description}}</text>
        </view>
        
        <view class="card-row">
          <text class="row-label">ã€æ•´æ”¹å»ºè®®ã€‘</text>
          <text class="row-content">{{item.suggestion}}</text>
        </view>
        
        <view class="card-row">
          <text class="region-icon">ğŸ“</text>
          <text class="region-text">é€‚ç”¨åœ°åŒºï¼š{{item.region || 'å…¨å›½'}}</text>
        </view>
        
        <!-- å±•å¼€è¯¦æƒ… -->
        <view class="card-detail" wx:if="{{expandedId === item.id}}">
          <view class="card-row">
            <text class="row-label">ã€æ³•å¾‹åŸæ–‡ã€‘</text>
            <text class="row-content">{{item.legalText}}</text>
          </view>
          <view class="card-row">
            <text class="row-label">ã€æ³•å¾‹æ³•è§„ã€‘</text>
            <text class="law-link">{{item.lawName}}</text>
          </view>
        </view>
        
        <!-- æ“ä½œæŒ‰é’® -->
        <view class="card-actions">
          <view class="action-btn" bindtap="toggleDetail" data-id="{{item.id}}">
            <text class="action-icon">ğŸ“‹</text>
            <text>è¯¦ç»†</text>
          </view>
          <view class="action-btn" bindtap="toggleFavorite" data-id="{{item.id}}">
            <text class="action-icon">{{item.isFavorite ? 'â­' : 'â˜†'}}</text>
            <text>æ”¶è—</text>
          </view>
          <view class="action-btn {{isSelected(item.id) ? 'selected' : ''}}" bindtap="toggleSelect" data-item="{{item}}">
            <text class="action-icon">{{isSelected(item.id) ? 'âœ“' : 'âŠ•'}}</text>
            <text>é€‰æ‹©</text>
          </view>
        </view>
      </view>
      
      <view class="empty-tip" wx:if="{{regulationList.length === 0}}">
        <text>æš‚æ— æ•°æ®</text>
      </view>
    </scroll-view>
    
  </view>

  <!-- æ‰‹åŠ¨è¾“å…¥æ¨¡å¼ -->
  <view class="manual-layout" wx:if="{{activeTab === 'manual'}}">
    <view class="manual-form">
      <view class="form-group">
        <text class="form-label">æ³•è§„åç§°</text>
        <input class="form-input" placeholder="è¯·è¾“å…¥æ³•è§„åç§°" bindinput="onManualNameInput" value="{{manualRegulation.name}}" />
      </view>
      <view class="form-group">
        <text class="form-label">æ³•è§„æ¡æ¬¾</text>
        <textarea class="form-textarea" placeholder="è¯·è¾“å…¥å…·ä½“æ³•è§„æ¡æ¬¾å†…å®¹" bindinput="onManualContentInput" value="{{manualRegulation.content}}" />
      </view>
      <view class="manual-add-btn" bindtap="addManualRegulation">æ·»åŠ è¯¥æ³•è§„</view>
    </view>
  </view>

  <!-- å·²é€‰æ³•è§„æ  -->
  <view class="selected-bar" wx:if="{{selectedRegulations.length > 0}}">
    <view class="selected-count">å·²é€‰ {{selectedRegulations.length}} æ¡</view>
    <view class="confirm-btn" bindtap="confirmSelection">ç¡®å®š</view>
  </view>

</view>
