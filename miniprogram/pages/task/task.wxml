<!--pages/task/task.wxml-->
<!-- ä»»åŠ¡ç®¡ç†é¡µé¢ - ä¼˜åŒ–ç‰ˆ -->
<view class="page-container">
  <!-- æ ‡ç­¾æ  -->
  <view class="tab-bar">
    <view class="tab-item {{currentTab === 'all' ? 'active' : ''}}" bindtap="switchTab" data-tab="all">
      <text class="tab-text">å…¨éƒ¨</text>
      <text class="tab-count">{{taskCounts.all}}</text>
    </view>
    <view class="tab-item {{currentTab === 'pending' ? 'active' : ''}}" bindtap="switchTab" data-tab="pending">
      <text class="tab-text">å¾…æ‰§è¡Œ</text>
      <text class="tab-count warning">{{taskCounts.pending}}</text>
    </view>
    <view class="tab-item {{currentTab === 'processing' ? 'active' : ''}}" bindtap="switchTab" data-tab="processing">
      <text class="tab-text">è¿›è¡Œä¸­</text>
      <text class="tab-count primary">{{taskCounts.processing}}</text>
    </view>
    <view class="tab-item {{currentTab === 'completed' ? 'active' : ''}}" bindtap="switchTab" data-tab="completed">
      <text class="tab-text">å·²å®Œæˆ</text>
      <text class="tab-count success">{{taskCounts.completed}}</text>
    </view>
  </view>

  <!-- ä»»åŠ¡åˆ—è¡¨ -->
  <scroll-view class="task-list" scroll-y refresher-enabled bindrefresherrefresh="onRefresh" refresher-triggered="{{refreshing}}">
    <view class="task-item card" wx:for="{{tasks}}" wx:key="id" bindtap="goToTaskDetail" data-id="{{item.id}}">
      <!-- ä»»åŠ¡å¤´éƒ¨ -->
      <view class="task-header">
        <view class="task-status-badge {{item.status}}">
          <text>{{item.status === 'pending' ? 'â³ å¾…æ‰§è¡Œ' : item.status === 'processing' ? 'ğŸ”„ è¿›è¡Œä¸­' : 'âœ… å·²å®Œæˆ'}}</text>
        </view>
        <text class="task-date">{{item.createDate}}</text>
      </view>
      
      <!-- ä»»åŠ¡æ ‡é¢˜ -->
      <text class="task-title">{{item.title}}</text>
      
      <!-- ä»»åŠ¡ä¿¡æ¯ -->
      <view class="task-info-grid">
        <view class="task-info-item">
          <text class="info-icon">ğŸ¢</text>
          <text class="info-text">{{item.enterpriseName}}</text>
        </view>
        <view class="task-info-item">
          <text class="info-icon">ğŸ‘¤</text>
          <text class="info-text">{{item.assigneeName}}</text>
        </view>
        <view class="task-info-item">
          <text class="info-icon">ğŸ“…</text>
          <text class="info-text deadline {{item.isUrgent ? 'urgent' : ''}}">æˆªæ­¢: {{item.deadline}}</text>
        </view>
      </view>
      
      <!-- è¿›åº¦æ¡ -->
      <view class="progress-section" wx:if="{{item.status !== 'completed'}}">
        <view class="progress-bar">
          <view class="progress-fill" style="width: {{item.progress}}%"></view>
        </view>
        <text class="progress-text">{{item.progress}}%</text>
      </view>
      
      <!-- ä»»åŠ¡åº•éƒ¨ -->
      <view class="task-footer">
        <view class="hazard-count">
          <text class="hazard-icon">âš ï¸</text>
          <text>å‘ç° {{item.hazardCount}} ä¸ªéšæ‚£</text>
        </view>
        <view class="task-action" wx:if="{{item.status === 'pending'}}" catchtap="startTask" data-id="{{item.id}}">
          <text>å¼€å§‹æ‰§è¡Œ â€º</text>
        </view>
        <view class="task-action" wx:elif="{{item.status === 'processing'}}" catchtap="continueTask" data-item="{{item}}">
          <text>ç»§ç»­æ’æŸ¥ â€º</text>
        </view>
      </view>
    </view>

    <!-- ç©ºçŠ¶æ€ -->
    <view class="empty-state" wx:if="{{tasks.length === 0}}">
      <text class="empty-icon">ğŸ“‹</text>
      <text class="empty-title">æš‚æ— ä»»åŠ¡</text>
      <text class="empty-desc">ç‚¹å‡»ä¸‹æ–¹æŒ‰é’®åˆ›å»ºæ–°çš„æ’æŸ¥ä»»åŠ¡</text>
    </view>
  </scroll-view>

  <!-- åˆ›å»ºä»»åŠ¡æŒ‰é’® -->
  <view class="fab" bindtap="goToCreateTask">
    <text class="fab-icon">+</text>
  </view>
</view>
