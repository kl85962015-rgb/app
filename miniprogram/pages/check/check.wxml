<!--pages/check/check.wxml-->
<view class="page-container">
  
  <view class="top-bar-wrapper">
    <view class="top-bar">
      <view class="ent-info">
        <text class="lbl-sm">å½“å‰æ£€æŸ¥å¯¹è±¡</text>
        <text class="val-lg">{{enterpriseName || 'è¯·é€‰æ‹©ä¼ä¸š'}}</text>
      </view>
      <view class="hazard-count">
        <text class="count-val">{{hazardList.length}}</text>
        <text class="count-lbl">å·²å‘ç°</text>
      </view>
    </view>
  </view>

  <view class="form-body">
    
    <!-- 1. ç°åœºç…§ç‰‡ -->
    <view class="form-group-card">
      <view class="sec-head">
        <text class="sec-title-cn">ç°åœºç…§ç‰‡ <text class="req-dot">*</text></text>
        <text class="sec-title-en">Evidence Photo</text>
      </view>
      
      <view class="grid-photos">
        <block wx:for="{{currentHazard.images}}" wx:key="*this">
          <view class="photo-cell">
            <image src="{{item}}" mode="aspectFill" bindtap="previewImage" data-index="{{index}}"></image>
            <view class="del-btn" catchtap="deleteImage" data-index="{{index}}">Ã—</view>
          </view>
        </block>
        
        <view class="add-cell" bindtap="takePhoto" wx:if="{{currentHazard.images.length < 9}}">
          <text class="plus-icon">+</text>
          <text class="add-txt">æ·»åŠ ç…§ç‰‡</text>
        </view>
      </view>
    </view>

    <!-- 2. éšæ‚£æè¿° -->
    <view class="form-group-card">
      <view class="sec-head">
        <text class="sec-title-cn">éšæ‚£æè¿° <text class="req-dot">*</text></text>
        <text class="sec-title-en">Description</text>
      </view>
      <textarea class="textarea-clean" placeholder="è¯·è¯¦ç»†æè¿°éšæ‚£æƒ…å†µ..." placeholder-style="color: #94A3B8" bindinput="onDescInput" value="{{currentHazard.description}}"></textarea>
    </view>

    <!-- 3. å…·ä½“ä½ç½® -->
    <view class="form-group-card">
      <view class="sec-head">
        <text class="sec-title-cn">å…·ä½“ä½ç½® <text class="req-dot">*</text></text>
        <text class="sec-title-en">Location</text>
      </view>
      <input class="input-clean" placeholder="ä¾‹å¦‚ï¼š1å·è½¦é—´ä¸œé—¨é…ç”µç®±" placeholder-style="color: #94A3B8" bindinput="onLocationInput" value="{{currentHazard.location}}" />
    </view>

    <!-- 4. é£é™©çº§åˆ« -->
    <view class="form-group-card">
      <view class="sec-head">
        <text class="sec-title-cn">é£é™©çº§åˆ«</text>
        <text class="sec-title-en">Risk Level</text>
      </view>
      <view class="level-capsules">
        <view class="capsule {{currentHazard.level === 'general' ? 'active' : ''}}" bindtap="selectLevel" data-level="general">ä¸€èˆ¬éšæ‚£</view>
        <view class="capsule {{currentHazard.level === 'major' ? 'active' : ''}}" bindtap="selectLevel" data-level="major">é‡å¤§éšæ‚£</view>
      </view>
    </view>

    <!-- 5. æ•´æ”¹å»ºè®® -->
    <view class="form-group-card">
      <view class="sec-head">
        <text class="sec-title-cn">æ•´æ”¹å»ºè®®</text>
        <text class="sec-title-en">Suggestion</text>
      </view>
      <textarea class="textarea-clean" style="height: 160rpx;" placeholder="è¯·è¾“å…¥æ•´æ”¹å»ºè®® (é€‰å¡«)" placeholder-style="color: #94A3B8" bindinput="onSuggestionInput" value="{{currentHazard.suggestion}}"></textarea>
    </view>

    <!-- 6. æ•´æ”¹æœŸé™ -->
    <view class="form-group-card">
      <view class="sec-head deadline-header">
        <view>
          <text class="sec-title-cn">æ•´æ”¹æœŸé™ <text class="req-dot">*</text></text>
          <text class="sec-title-en">Deadline</text>
        </view>
        <view class="quick-days">
          <view class="day-chip {{currentHazard.deadlineType === '3' ? 'active' : ''}}" bindtap="setQuickDeadline" data-days="3">3å¤©</view>
          <view class="day-chip {{currentHazard.deadlineType === '7' ? 'active' : ''}}" bindtap="setQuickDeadline" data-days="7">7å¤©</view>
        </view>
      </view>
      
      <picker mode="date" value="{{currentHazard.deadline}}" start="{{today}}" bindchange="onDeadlineChange">
        <view class="picker-wrap">
          <text wx:if="{{currentHazard.deadline}}">{{currentHazard.deadline}}</text>
          <text wx:else style="color: #94A3B8">è¯·é€‰æ‹©æ•´æ”¹æˆªæ­¢æ—¥æœŸ</text>
          <text class="picker-arrow">ğŸ“…</text>
        </view>
      </picker>
    </view>

  </view>

  <!-- åº•éƒ¨æ  -->
  <view class="bottom-bar">
    <view class="btn-sec" bindtap="addAndContinue">ä¿å­˜ç»§ç»­</view>
    <view class="btn-pri" bindtap="finishCheck">å®Œæˆæ£€æŸ¥</view>
  </view>

</view>
